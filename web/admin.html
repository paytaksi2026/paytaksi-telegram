<!doctype html>
<html lang="az">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>PayTaksi â€” Admin Paneli</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      :root{--bg:#0f172a;--panel:#111827;--card:#0b1220;--text:#e5e7eb;--muted:#94a3b8;--border:rgba(255,255,255,.10);--green:#22c55e;}
      body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
      .top{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:10px;}
      .title{font-size:16px;font-weight:900;}
      .btn{border:0;border-radius:12px;padding:10px 12px;font-weight:800;background:var(--green);color:#06121f;cursor:pointer;}
      .wrap{padding:12px;display:grid;gap:10px;}
      .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px;}
      .muted{color:var(--muted);font-size:13px;}
      table{width:100%;border-collapse:collapse;margin-top:8px;}
      th,td{padding:8px;border-bottom:1px solid var(--border);font-size:13px;text-align:left;}
      th{color:var(--muted);font-weight:700;}
    </style>
  </head>
  <body>
    <div class="top">
      <div class="title">ðŸ›  Admin Paneli</div>
      <button id="btnReload" class="btn">YenilÉ™</button>
    </div>

    <div class="wrap">
      <div class="card">
        <div class="title" style="font-size:14px">ðŸ‘¥ Drivers</div>
        <div class="muted" id="driversInfo">YÃ¼klÉ™nirâ€¦</div>
        <div id="driversTable"></div>
      </div>

      <div class="card">
        <div class="title" style="font-size:14px">ðŸ“¦ SifariÅŸlÉ™r</div>
        <div class="muted">Bu baza versiyada yalnÄ±z "pending" sifariÅŸ gÃ¶stÉ™rilir.</div>
        <div id="ordersBox" class="muted" style="margin-top:8px"></div>
      </div>
    </div>

    <script>
      const tg = window.Telegram?.WebApp;
      if(tg){ tg.ready(); tg.expand(); }
      const api = location.origin;

      async function load(){
        // drivers
        const d = await fetch(api + '/api/drivers').then(r=>r.ok?r.json():null);
        const list = d?.drivers || [];
        document.getElementById('driversInfo').textContent = `Driver sayÄ±: ${list.length}`;
        document.getElementById('driversTable').innerHTML = renderDrivers(list);

        // pending order
        const p = await fetch(api + '/api/order/pending').then(r=>r.ok?r.json():null);
        document.getElementById('ordersBox').textContent = p?.order
          ? `Pending: ID ${p.order.id} â€¢ ${p.order.fromText || ''} â†’ ${p.order.toText || ''}`
          : 'Pending sifariÅŸ yoxdur.';
      }

      function renderDrivers(list){
        if(!list.length) return '<div class="muted" style="margin-top:8px">Driver yoxdur.</div>';
        const rows = list.map(d=>`<tr><td>${d.id}</td><td>${escapeHtml(d.name||'')}</td><td>${d.online?'âœ…':'â€”'}</td><td>${d.lat?.toFixed?d.lat.toFixed(5):d.lat||''}</td></tr>`).join('');
        return `<table><thead><tr><th>ID</th><th>Ad</th><th>Onlayn</th><th>Lat</th></tr></thead><tbody>${rows}</tbody></table>`;
      }

      function escapeHtml(s){
        return String(s).replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
      }

      document.getElementById('btnReload').onclick = ()=>load().catch(()=>{});
      load().catch(()=>{});
      setInterval(()=>load().catch(()=>{}), 5000);
    </script>
  </body>
</html>
