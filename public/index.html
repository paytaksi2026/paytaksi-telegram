<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PayTaksi</title>
<style>
  body{background:#0b1220;color:#e5e7eb;font-family:Arial,Helvetica,sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0}
  .card{width:min(520px,92vw);background:rgba(15,23,42,.75);border:1px solid rgba(148,163,184,.2);border-radius:14px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  h2{margin:0 0 12px 0;text-align:center;font-weight:700}
  .row{display:flex;gap:10px}
  select,input,button{width:100%;padding:12px 12px;border-radius:10px;border:1px solid rgba(148,163,184,.25);background:rgba(2,6,23,.55);color:#e5e7eb}
  input::placeholder{color:rgba(226,232,240,.55)}
  button{cursor:pointer;border:none;background:#22c55e;color:#081014;font-weight:700}
  button.secondary{background:rgba(148,163,184,.15);color:#e5e7eb;border:1px solid rgba(148,163,184,.25)}
  .msg{margin-top:12px;text-align:center;min-height:22px}
  .hint{opacity:.8;font-size:12px;text-align:center;margin-top:10px}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid rgba(148,163,184,.25);background:rgba(148,163,184,.10);font-size:12px;margin:0 auto 12px auto}
</style>
</head>
<body>
  <div class="card">
    <h2>PayTaksi Daxil OL / Qeydiyyat</h2>
    <div style="text-align:center"><span class="pill">Role seç: Sernishin və ya Surucu</span></div>

    <select id="role">
      <option value="passenger">Musteri</option>
      <option value="driver">Surucu</option>
    </select>
    <div style="height:10px"></div>

    <input id="phone" placeholder="+994501234567" autocomplete="tel" />
    <div style="height:10px"></div>
    <input id="password" type="password" placeholder="Şifrə" autocomplete="current-password" />
    <div style="height:10px"></div>
    <input id="name" placeholder="Ad Soyad (qeydiyyat üçün)" autocomplete="name" />

    <div style="height:14px"></div>
    <div class="row">
      <button id="btnReg" onclick="registerUser()">Qeydiyyat</button>
      <button id="btnLogin" class="secondary" onclick="loginUser()">Daxil OL</button>
    </div>

    <div class="msg" id="msg"></div>
    <div class="hint">
      Surucu qeydiyyatı: admin təsdiqi lazımdır (pending). Musteri dərhal aktivdir.
    </div>
  </div>

<script>
const msg = document.getElementById('msg');
function setMsg(t){ msg.textContent = t || ''; }

async function registerUser() {
  setMsg('...');
  const res = await fetch('/api/register', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({
      phone: phone.value,
      password: password.value,
      role: role.value,
      name: name.value
    })
  });
  const data = await res.json();
  if (data.success) {
    if (data.role === 'driver') {
      setMsg('Qeydiyyatdan kecdiniz. Surucu hesabı təsdiq gözləyir.');
    } else {
      setMsg('Qeydiyyatdan Kecdiniz. İndi Daxil Olun.');
    }
  } else {
    setMsg(data.error || 'ERROR');
  }
}

async function loginUser() {
  setMsg('...');
  const res = await fetch('/api/login', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({
      phone: phone.value,
      password: password.value,
      role: role.value
    })
  });
  const data = await res.json();
  if (data.pending) {
    setMsg('Driver pending approval (admin təsdiqi gözləyir).');
  } else if (data.success) {
    setMsg('Login success');
  } else {
    setMsg(data.error || 'ERROR');
  }
}
</script>
</body>
</html>
