<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pricing Settings</title>
<style>
body{font-family:Arial;background:#0f172a;color:#fff;padding:20px}
input{padding:8px;margin:6px 0;width:100%}
button{padding:10px;background:#22c55e;border:none;color:#000;font-weight:bold;cursor:pointer}
.card{background:#1e293b;padding:20px;border-radius:12px;max-width:400px}
</style>
</head>
<body>
<div class="card">
<h2>Tarif Parametrləri</h2>

<label>Start qiyməti</label>
<input id="fare_base" type="number" step="0.01">

<label>1 km qiyməti</label>
<input id="fare_per_km" type="number" step="0.01">

<label>Minimum qiymət</label>
<input id="fare_min" type="number" step="0.01">

<label>1 dəqiqə qiyməti</label>
<input id="fare_per_min" type="number" step="0.01">

<label>Komissiya %</label>
<input id="commission" type="number" step="1">

<button onclick="save()">Yadda saxla</button>
<p id="msg"></p>
</div>

<script>
async function load(){
 try{
   const r = await fetch('/api/settings');
   const d = await r.json();
   const s = (d && d.settings) ? d.settings : d;
   fare_base.value = (s.fare_base ?? 1);
   fare_per_km.value = (s.fare_per_km ?? 0.6);
   fare_min.value = (s.fare_min ?? 2);
   fare_per_min.value = (s.fare_per_min ?? 0.15);
   // legacy % field
   commission.value = (d.commission ?? Math.round((Number(s.commission_rate||0))*100) ?? 10);
 }catch(e){}
}

async function save(){
 const data = {
  fare_base: parseFloat(fare_base.value),
  fare_per_km: parseFloat(fare_per_km.value),
  fare_per_min: parseFloat(fare_per_min.value),
  fare_min: parseFloat(fare_min.value),
  commission: parseInt(commission.value)
 };

 await fetch('/api/settings',{
  method:'POST',
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify(data)
 });

 msg.innerText="Yadda saxlanıldı";
}

load();
</script>
</body>
</html>
