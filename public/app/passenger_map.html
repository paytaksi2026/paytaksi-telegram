<!doctype html>
<html lang="az">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Xəritə & Sifariş - PayTaksi</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
body{margin:0;background:#0b1220;color:#e5e7eb;font-family:Arial}
#map{height:55vh;width:100%}
.wrap{max-width:980px;margin:0 auto;padding:14px}
.card{background:#0f172a;border-radius:14px;overflow:hidden}
.pad{padding:14px}
input,button{width:100%;padding:12px;border-radius:10px;border:1px solid #334155;background:#020617;color:#fff}
button{background:#22c55e;border:none;color:#081014;font-weight:700;cursor:pointer}
.row{display:flex;gap:10px;flex-wrap:wrap}
.msg{margin-top:10px;min-height:20px}
.pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#1e293b;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
<div class="card">
<div id="map"></div>
<div class="pad">

<label>Haradan</label>
<input id="from"/>

<label style="margin-top:10px">Haraya</label>
<input id="to"/>

<div style="height:12px"></div>
<button onclick="createOrder()">Sifariş et</button>
<div class="msg" id="msg"></div>

</div>
</div>
</div>

<script>
let map = L.map('map').setView([40.4093,49.8671],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

let pickup=null, dropoff=null;
let fromMarker=null, toMarker=null, routeLine=null;

async function geocode(q){
 const r=await fetch('https://nominatim.openstreetmap.org/search?format=json&q='+encodeURIComponent(q)+'&countrycodes=az');
 const j=await r.json();
 if(j.length) return {lat:+j[0].lat,lon:+j[0].lon,text:j[0].display_name};
 return null;
}

async function drawRoute(){
 if(!pickup||!dropoff) return;
 const url=`https://router.project-osrm.org/route/v1/driving/${pickup.lon},${pickup.lat};${dropoff.lon},${dropoff.lat}?overview=full&geometries=geojson`;
 const r=await fetch(url);
 const j=await r.json();
 if(!j.routes||!j.routes.length) return;
 const coords=j.routes[0].geometry.coordinates.map(c=>[c[1],c[0]]);
 if(routeLine) map.removeLayer(routeLine);
 routeLine=L.polyline(coords,{color:'#22c55e',weight:5}).addTo(map);
 map.fitBounds(routeLine.getBounds(),{padding:[40,40]});
}

document.getElementById('from').addEventListener('change',async e=>{
 const g=await geocode(e.target.value);
 if(!g) return;
 pickup=g;
 if(fromMarker) map.removeLayer(fromMarker);
 fromMarker=L.marker([g.lat,g.lon]).addTo(map).bindPopup('Haradan').openPopup();
 drawRoute();
});

document.getElementById('to').addEventListener('change',async e=>{
 const g=await geocode(e.target.value);
 if(!g) return;
 dropoff=g;
 if(toMarker) map.removeLayer(toMarker);
 toMarker=L.marker([g.lat,g.lon]).addTo(map).bindPopup('Haraya').openPopup();
 drawRoute();
});

function createOrder(){
 if(!pickup||!dropoff){document.getElementById('msg').textContent='Ünvanları seçin.';return;}
 document.getElementById('msg').textContent='Marşrut çəkildi ✅';
}
</script>
</body>
</html>
